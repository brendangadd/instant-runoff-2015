"use strict";function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function createNextRankDistribution(t){var e={},a=!0,r=!1,n=void 0;try{for(var o,s=Object.keys(NEXT_RANK_DISTRIBUTION)[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;e[l]=NEXT_RANK_DISTRIBUTION[l]}}catch(i){r=!0,n=i}finally{try{!a&&s["return"]&&s["return"]()}finally{if(r)throw n}}var d=[{party:Party.BLOC,probability:t.bloc/100},{party:Party.CONSERVATIVE,probability:t.conservative/100},{party:Party.GREEN,probability:t.green/100},{party:Party.LIBERAL,probability:t.liberal/100},{party:Party.NDP,probability:t.ndp/100}];return e.BLANK=d,e}function updateProgress(t){var e=document.querySelector("#progress"),a=100*t,r=Math.round(a);e.setAttribute("aria-valuenow",r),e.style.width=a+"%",e.textContent=r+"%"}function updateSeatCounts(){document.querySelector("#seat-count-bloc span").textContent=seats[Party.BLOC]||0,document.querySelector("#seat-count-conservative span").textContent=seats[Party.CONSERVATIVE]||0,document.querySelector("#seat-count-green span").textContent=seats[Party.GREEN]||0,document.querySelector("#seat-count-liberal span").textContent=seats[Party.LIBERAL]||0,document.querySelector("#seat-count-ndp span").textContent=seats[Party.NDP]||0}function addResultTableRow(t){var e=document.createElement("tr"),a=document.createElement("td"),r=document.createElement("td"),n=document.createElement("td");a.textContent=t.districtName,r.textContent=t.plurality,n.textContent=t.winner,e.appendChild(a),e.appendChild(r),e.appendChild(n),document.querySelector("#result-table tbody").appendChild(e)}function simpleBarChart(t,e,a){var r=document.querySelector(t).getContext("2d"),n=new Chart(r).Bar({labels:e,datasets:[{data:a}]},{scaleShowVerticalLines:!1});return n}function colorChart(t,e){for(var a=0;a<e.length;a++)t.datasets[0].bars[a].fillColor=e[a],t.datasets[0].bars[a].strokeColor=e[a];t.update()}var _dataIndex,numDistricts=1,numElectionsCompleted=0,seats={},electionWorker=new Worker("js/election-worker.js");Chart.defaults.global.responsive=!0,Chart.defaults.global.maintainAspectRatio=!1,Chart.defaults.global.scaleOverride=!0,Chart.defaults.global.scaleSteps=10,Chart.defaults.global.scaleStepWidth=25,Chart.defaults.global.scaleStartValue=0;var chartLabels=["Bloc","Conservative","Green","Liberal","NDP"],chartColors=["#09c","#00e","#0c0","#a00","#f90"],fptpChart=simpleBarChart("#chart-fptp",chartLabels,[10,99,1,184,44]);colorChart(fptpChart,chartColors);var irvChart=simpleBarChart("#chart-irv",chartLabels,[0,0,0,0,0]);colorChart(irvChart,chartColors);var dataIndex=(_dataIndex={},_defineProperty(_dataIndex,Party.BLOC,0),_defineProperty(_dataIndex,Party.CONSERVATIVE,1),_defineProperty(_dataIndex,Party.GREEN,2),_defineProperty(_dataIndex,Party.LIBERAL,3),_defineProperty(_dataIndex,Party.NDP,4),_dataIndex),client=new XMLHttpRequest;document.querySelector("#start").addEventListener("click",function(){this.setAttribute("disabled","disabled"),client.open("GET","resources/data.json"),client.send(),document.body.className="state-inelection"}),client.onload=function(){var t=JSON.parse(this.response);numDistricts=t.length;var e=!0,a=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var s=n.value,l=createNextRankDistribution(s);electionWorker.postMessage({districtName:s.district,totalVotes:s.totalVotes,nextRankDistribution:l})}}catch(i){a=!0,r=i}finally{try{!e&&o["return"]&&o["return"]()}finally{if(a)throw r}}},electionWorker.onmessage=function(t){var e=t.data.winner;seats.hasOwnProperty(e)||(seats[e]=0),seats[e]++,updateProgress(++numElectionsCompleted/numDistricts),updateSeatCounts(),addResultTableRow(t.data),irvChart.datasets[0].bars[dataIndex[t.data.winner]].value++,irvChart.update(),console.log(t.data.districtName,t.data.winner)};
//# sourceMappingURL=main.js.map
